<!-- Solo se muestra si ya se carg√≥ el establecimiento -->
<div *ngIf="establecimiento; else cargando" class="detalle">

  <!-- Caja visual con datos del establecimiento -->
  <div class="detalle-contenido-visual">
    <!-- T√≠tulo y datos generales -->
    <h2>{{ establecimiento.nombre }}</h2>
    <p><strong>Ubicaci√≥n:</strong> {{ establecimiento.ubicacion }}</p>
    <p><strong>Descripci√≥n:</strong> {{ establecimiento.descripcion }}</p>
    <p><strong>Valoraci√≥n media:</strong> {{ establecimiento.valoracionMedia || 'Sin valoraciones a√∫n' }}</p>

    <!-- Contenido dividido en dos columnas: valoraciones + formulario -->
    <div class="detalle-contenido">

      <!-- üìç Columna izquierda: Lista de valoraciones -->
      <div class="valoraciones">
        <h3>Comentarios de usuarios</h3>

        <!-- Mensaje si no hay valoraciones -->
        <div *ngIf="valoraciones.length === 0">
          <p>No hay valoraciones a√∫n.</p>
        </div>

        <!-- Lista de valoraciones si hay alguna -->
        <ul *ngIf="valoraciones.length > 0">
          <li *ngFor="let val of valoraciones">
            <p>‚≠ê {{ val.puntuacion }} ‚Äî "{{ val.comentario }}"</p>
            <p class="autor">
              <em>por {{ val.usuario.nombre }} el {{ val.fechaComentario }}</em>
            </p>
          </li>
        </ul>
      </div>

      <!-- ‚úçÔ∏è Columna derecha: Formulario para a√±adir nueva valoraci√≥n -->
      <div class="nueva-valoracion">
        <h3>¬°Deja tu valoraci√≥n!</h3>

        <!-- Formulario vinculado a (ngSubmit) y a ngModel -->
        <form (ngSubmit)="enviarValoracion()" #valoracionForm="ngForm">
          <!-- Select de puntuaci√≥n -->
          <label for="puntuacion">Puntuaci√≥n:</label>
          <select
            id="puntuacion"
            [(ngModel)]="nuevaValoracion.puntuacion"
            name="puntuacion"
            required
          >
            <option value="" disabled selected>Selecciona una puntuaci√≥n</option>
            <option *ngFor="let i of [1,2,3,4,5]" [value]="i">{{ i }} ‚≠ê</option>
          </select>

          <!-- Campo de comentario -->
          <label for="comentario">Comentario:</label>
          <textarea
            id="comentario"
            rows="4"
            [(ngModel)]="nuevaValoracion.comentario"
            name="comentario"
            placeholder="Escribe tu opini√≥n..."
            required
          ></textarea>

          <!-- Bot√≥n de enviar -->
          <button type="submit">Enviar valoraci√≥n</button>
        </form>
      </div>
    </div> <!-- Fin de detalle-contenido -->
  </div> <!-- Fin de detalle-contenido-visual -->
</div>

<!-- Plantilla alternativa: se muestra mientras se cargan los datos -->
<ng-template #cargando>
  <p>Cargando datos del establecimiento...</p>
</ng-template>
